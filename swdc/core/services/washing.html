<link type='text/css' rel='stylesheet' href='https://unpkg.com/tippy.js@1.2.0/dist/tippy.css' />
<section class='card'>
    <h2 class='lightblue'>Заказ стиральной машины</h2>
    <div>
        <p>
            <b>Что&nbsp;значат&nbsp;цвета?</b>
        </p>
        <p class='card-maintext'>
            <span class='preview'></span> - Этот интервал можно выбирать<br />
            <span class='preview ended'></span> - Этот интервал уже нельзя выбирать<br />
            <span class='preview selected'></span> - Этот интервал был кем-то выбран<br />
            <span class='preview choisen'></span> - Этот интервал был выбран вами<br />
            <span class='preview started'></span> - Этот интервал можно выбирать, но он уже идет и прошло меньше половины(?)
        </p>
        <p><b>Чтоб выбрать или отменить выбор интервала нажми на него</b></p>
    </div>
</section>
<form action='' method='post' id='washing'>
    <div class='card'>
        <h2>Понедельник 04.09</h2>
        <table class='table_aside'>
            <tr>
                <th>Интервалы</th>
            </tr>
            <tr>
                <td>9:00</td>
            </tr>
            <tr>
                <td>9:00</td>
            </tr>
            <tr>
                <td>9:30</td>
            </tr>
            <tr>
                <td>10:00</td>
            </tr>
        </table>
        <table class='table_main'>
            <tr>
                <th>Машина №1<br /><small>(10 руб.)</small></th>
                <th>Машина №2<br /><small>(10 руб.)</small></th>
                <th>Машина №3<br /><small>(10 руб.)</small></th>
                <th>Машина №4<br /><small>(10 руб.)</small></th>
                <th>Машина №5<br /><small>(10 руб.)</small></th>
            </tr>
            <tr>
                <td class='ended'></td>
                <td class='ended'></td>
                <td class='ended'></td>
                <td class='ended'></td>
                <td class='ended selected'></td>
            </tr>
            <tr>
                <td class='started selected'></td>
                <td class='started'>
                    <label>
                            <input type='checkbox' name='2-2' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class='started selected'>
                    <label class='userinfo' for='modal_userinfo_check' onclick='showuserinfo("Иванов Иван Иванович", "39333502", "+79777777777", "email@example.com");' title='Посмотреть инфо о заказавшем(-ей)'></label>
                </td>
                <td class='started'>
                    <label>
                            <input type='checkbox' name='2-4' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class='started selected'></td>
            </tr>
            <tr>
                <td class=''>
                    <label>
                            <input type='checkbox' name='3-1' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='3-2' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class='choisen'></td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='3-4' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='3-5' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
            </tr>
            <tr>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-1' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-2' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-3' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-4' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-5' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
            </tr>
        </table>
    </div>
    <div class='card'>
        <h2>Вторник 05.09</h2>
        <table class='table_aside'>
            <tr>
                <th>Интервалы</th>
            </tr>
            <tr>
                <td>9:00</td>
            </tr>
            <tr>
                <td>9:00</td>
            </tr>
            <tr>
                <td>9:30</td>
            </tr>
            <tr>
                <td>10:00</td>
            </tr>
        </table>
        <table class='table_main'>
            <tr>
                <th>Машина №1<br /><small>(10 руб.)</small></th>
                <th>Машина №2<br /><small>(10 руб.)</small></th>
                <th>Машина №3<br /><small>(10 руб.)</small></th>
                <th>Машина №4<br /><small>(10 руб.)</small></th>
                <th>Машина №5<br /><small>(10 руб.)</small></th>
            </tr>
            <tr>
                <td class=''>
                    <label>
                            <input type='checkbox' name='1-1' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='1-2' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='1-3' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='1-4' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class='selected'></td>
            </tr>
            <tr>
                <td class='selected'></td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='2-2' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class='selected'></td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='2-4' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class='selected'></td>
            </tr>
            <tr>
                <td class=''>
                    <label>
                            <input type='checkbox' name='3-1' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='3-2' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='3-3' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='3-4' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='3-5' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
            </tr>
            <tr>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-1' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-2' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-3' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-4' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
                <td class=''>
                    <label>
                            <input type='checkbox' name='4-5' data-price='10' class='hidden' />
                            <span>V</span>
                        </label>
                </td>
            </tr>
        </table>
    </div>
    <div class='card hidden' id='preresult'>
        <p id='pretext'></p>
    </div>
    <div class='card' id='finalresult'>
        <p id='finaltext'>
            Вы ничего не выбрали
        </p>
        <input id='finalcancel' type='button' value='Сбросить' />
        <input id='finalsubmit' type='submit' value='Подтверждаю' />
    </div>
</form>
<script src='https://unpkg.com/tippy.js@1.2.0/dist/tippy.min.js'></script>
<script>
    window.addEventListener('load', function() {
        var preview = document.querySelector('#pretext'),
            finalview = document.querySelector('#finaltext'),
            currentprice = 0,
            price = 0,
            addwash = 0,
            removewash = 0,
            inputs = document.querySelector('#washing').querySelectorAll('input[type=checkbox]');

        for (var item of inputs) {
            item.addEventListener('change', function() {
                price = parseInt(this.getAttribute('data-price'), 10);
                if (this.checked) {
                    if (price > 0) {
                        addwash++;
                    } else {
                        removewash++;
                    }
                    currentprice += price;
                } else {
                    if (price > 0) {
                        addwash--;
                    } else {
                        removewash--;
                    }
                    currentprice -= price;
                }
                if (addwash > 0) {
                    preview.innerHTML = ((addwash > 0) ? ('Заказано: ' + addwash) : '') + ' Итого: ' + currentprice + 'руб. <a href="#finaltext">К оплате</a>';
                    document.querySelector('#preresult').classList.remove('hidden');
                    finalview.innerHTML = 'Вы выбрали ' + addwash + ' интервалов<br />Итого ' + ((currentprice > 0) ? ('нужно оплатить ' + currentprice) : ('вам вернут ' + (-currentprice))) + ' руб.';
                } else {
                    finalview.innerHTML = 'Вы ничего не выбрали';
                    document.querySelector('#preresult').classList.add('hidden');
                }
            });
        }
        document.querySelector('#finalcancel').addEventListener('click', function() {
            addwash = 0;
            removewash = 0;
            currentprice = 0;
            for (var item of inputs) {
                item.checked = false;
            };
            finalview.innerHTML = 'Вы ничего не выбрали';
            document.querySelector('#preresult').classList.add('hidden');
        });
    });

    function showuserinfo(name, vkid, number, email) {
        var uservkid = document.querySelector('#userinfo_vkid'),
            usernumber = document.querySelector('#userinfo_number'),
            useremail = document.querySelector('#userinfo_email');
        usernumber.classList.add('hidden');
        uservkid.classList.add('hidden');
        useremail.classList.add('hidden');
        username.innerText = name;
        if (number !== null) {
            usernumber.innerText = 'Позвонить: ' + number;
            usernumber.href = 'tel:' + number;
            usernumber.classList.remove('hidden');
        }
        if (vkid !== null) {
            uservkid.href = 'https://vk.me/id' + vkid;
            uservkid.classList.remove('hidden');
        }
        if (email !== null) {
            useremail.innerText = 'Написать: ' + email;
            useremail.href = 'mailto:' + email;
            useremail.classList.remove('hidden');
        }
    };
    tippy('.userinfo');

</script>
